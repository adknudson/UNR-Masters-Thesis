```{r ch060-setup, include=FALSE}
library(dagitty)
library(tidyverse)
library(purrr)
library(patchwork)

source("R/ch060.R")

# p034s_av  <- readRDS("models/p034s_av.rds")
# p034s_vis <- readRDS("models/p034s_vis.rds")
# p034s_dur <- readRDS("models/p034s_dur.rds")
# p034s_sm  <- readRDS("models/p034s_sm.rds")

two_colors   <- c("orangered3", "steelblue4")
three_colors <- c("goldenrod2", "turquoise3", "indianred4")

av  <- post_table(readRDS("models/p034s_av.rds")) %>% 
  add_column(Task = "Audiovisual", .before = 1)
vis <- post_table(readRDS("models/p034s_vis.rds")) %>% 
  add_column(Task = "Visual", .before = 1)
dur <- post_table(readRDS("models/p034s_dur.rds")) %>% 
  add_column(Task = "Duration", .before = 1)
sm  <- post_table(readRDS("models/p034s_sm.rds")) %>% 
  add_column(Task = "Sensorimotor", .before = 1)

post <- bind_rows(av, vis, dur, sm) %>%
  mutate(Task = factor(Task, levels = c("Audiovisual", "Visual", "Duration", "Sensorimotor")))
```


# Psychometric Results {#results}

## Affect of Adaptation across Age Groups

### On Perceptual Synchrony

**Audiovisual TOJ Task**

```{r ch060-Eastern-Cat}
plot_pss(av)
```


**Visual TOJ Task**

```{r ch060-Gruesome-Waffle}
plot_pss(vis)
```

**Duration TOJ Task**

```{r ch060-Stormy-Frostbite}
plot_pss(dur)
```

**Sensorimotor TOJ Task**

```{r ch060-Homeless-Anaconda}
plot_pss(sm)
```

### On Temporal Sensitivity

**Audiovisual TOJ Task**

```{r ch060-Timely-Toupee}
plot_jnd(av)
```


**Visual TOJ Task**

```{r ch060-Mercury-Rainbow}
plot_jnd(vis)
```

**Duration TOJ Task**

```{r ch060-Aimless-Planet}
plot_jnd(dur)
```

**Sensorimotor TOJ Task**

```{r ch060-Tombstone-Cold}
plot_jnd(sm)
```

## Lapse Rates across Age Groups


```{r ch060-Waffle-Hollow, fig.cap="Process model of the result of a psychometric experiment with the assumption that lapses occur at random and at a fixed rate, and that the subject guesses randomly in the event of a lapse."}
lapse_dag <- dagitty("dag{
  Start -> Lapse
  Start -> NoLapse
  Lapse -> PositiveResponse
  Lapse -> NegativeResponse
  NoLapse -> PositiveResponse
  NoLapse -> NegativeResponse
}")
coordinates(lapse_dag) <- list(x=c(Lapse=0, PositiveResponse=0,
                                   Start=1,
                                   NoLapse=2, NegativeResponse=2),
                               y=c(Start=0,
                                   Lapse=1, NoLapse=1,
                                   PositiveResponse=2, NegativeResponse=2))

plot(lapse_dag)
text(x = c(0.5, 1.5,
           0.05, 0.5,
           1.5, 1.9), 
     y = c(-0.4, -0.4,
           -1.5, -1.2,
           -1.2, -1.5), 
     labels = c("γ", "1 - γ",
                "0.5", "0.5",
                "F(x)", "1-F(X)"))
```

In the above figure, the outcome of one experiment can be represented as a directed acyclic graph (DAG) where at the start of the experiment, the subject either experiences a lapse in judgment with probability $\gamma$ or they do not experience a lapse in judgment. If there is no lapse, then they will give a positive response with probability $F(x)$. If there is a lapse in judgment, then it is assumed that they will respond randomly - e.g. a fifty-fifty chance of a positive response. In this model of an experiment, the probability of a positive response is the sum of the two paths.


\begin{align}
\mathrm{P}(\textrm{positive}) &= 
  \mathrm{P}(\textrm{lapse}) \cdot \mathrm{P}(\textrm{positive} | \textrm{lapse}) + 
  \mathrm{P}(\textrm{no lapse}) \cdot \mathrm{P}(\textrm{positive} | \textrm{no lapse}) \\
  &= \frac{1}{2} \gamma + (1 - \gamma) \cdot F(x)
\end{align}


If we then let $\gamma = 2\lambda$ then the probability of a positive response becomes

$$
\mathrm{P}(\textrm{positive}) = \lambda + (1 - 2\lambda) \cdot F(x)
$$

This is the lapse model described in \@ref(eq:Psi)! But now there is a little bit more insight into what the parameter $\lambda$ is. If $\gamma$ is the true lapse rate, then $\lambda$ is half the lapse rate. This may sound strange at first, but remember that equation \@ref(eq:Psi) was motivated as a lower and upper bound to the psychometric function, and where the bounds are constrained by the same amount. Here the motivation is from a process model, yet the two lines of reasoning arrive at the same model. 

```{r ch060-Magenta-Finger}
ggplot(post, aes(gamma, fill = `Age Group`)) +
  geom_density(alpha = 0.75) +
  scale_fill_manual(values = three_colors) +
  facet_grid(Task ~ .) +
  theme(axis.text.y = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.y = element_blank()) +
  labs(x = "Lapse Rate")
```

